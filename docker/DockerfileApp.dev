FROM node:22.9.0-alpine AS builder

RUN mkdir /nodejs2024Q3-service

WORKDIR /nodejs2024Q3-service

RUN mkdir -p /var/log/web/ml && chmod 777 /var/log/web/ml

RUN touch /var/log/web/ml/log-$(date +%Y-%m-%dT%H:%M:%S)

RUN touch /var/log/web/ml/error-$(date +%Y-%m-%dT%H:%M:%S)

COPY ./package*.json ./

RUN npm install

COPY . .

RUN npx prisma generate

EXPOSE ${PORT}

CMD ["npx", "prisma", "migrate", "deploy"]