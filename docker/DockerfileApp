FROM node:22.9.0 AS builder

RUN mkdir /nodejs2024Q3-service

WORKDIR /nodejs2024Q3-service

COPY ./package*.json ./

RUN npm install

COPY . .

RUN npm run build

FROM node:22.9.0

ENV PORT=4000

ENV DATABASE_URL="postgresql://musicLover:libraryRSS@postgres:5432/library?schema=public"

WORKDIR /nodejs2024Q3-service

# COPY --from=builder ./dist ./dist
# COPY --from=builder ./node_modules ./node_modules
COPY --from=builder /nodejs2024Q3-service/dist ./dist
COPY --from=builder /nodejs2024Q3-service/node_modules ./node_modules

EXPOSE ${PORT}

CMD ["node", "dist/main"]